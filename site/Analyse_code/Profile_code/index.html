<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Profile your Code - DIaL3</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Profile your Code";
    var mkdocs_page_input_path = "Analyse_code/Profile_code.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DIaL3</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../About_dial3/architecture/">Architecture</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../About_dial3/filesystem/">Filesystem</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Statrted</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Getting_started/create_account/">Create Account</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Getting_started/connecting_dial3/">Connecting</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Run a Computation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Run_computation/interactive_or_batch/">Intercative or batch</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Run_computation/Scheduler/">Scheduler</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Run_computation/submit_job/">Submit a Job</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Run_computation/job_types/">Job types</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Run_computation/monitor_jobs/">Monitor jobs</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Analyse code using Arm Forge</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../about_arm_forge/">What is Arm Forge</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Install_arm_forge/">Install Arm Forge</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Perf_report/">Performance Report</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Profile your Code</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Debug_code/">Debug your Code</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Help</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Support/Contact/">Contact</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Support/FAQ/">Frequently asked questions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../Support/Support_staff/">Support Staff</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DIaL3</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Analyse code using Arm Forge &raquo;</li>
        
      
    
    <li>Profile your Code</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="profile-your-code-using-arm-map">Profile your code using Arm MAP</h1>
<p>Arm MAP is a Arm Forge's scalable profiler that can be used to profile serial and parallel applications. It allows you to profile your code without distorting application behaviour. It can be used to profile C, C++, Cuda, Fortran and Python code with no instrumentation or code changes. It helps the developers to accelerate their code by revealing the bottlenecks in their code such as the function taking maximum time, excessive time spent in  MPI communication, slow I/O etc. </p>
<p>In order to profile your code, please follow the stpes given below.</p>
<p><strong>1.</strong> Recompile your code by including the debug flag i.e. <code>-g</code>. This will allow the Arm MAP to gather the necessary information during runtime.</p>
<p><strong>2.</strong> You can use the following script to the scheduler which will automatically generate your code profile.</p>
<pre><code class="language-bash">#!/bin/bash --login

#SBATCH -J Your_Job_Name
#SBATCH -o Your_Object_File_Name.o%j
#SBATCH -e Your_Error_File_Name.e%j
#SBATCH -p Partition_on_which_to_run_code
##SBATCH -A Account
#SBATCH --nodes=8
#SBATCH --ntasks=16
#SBATCH --ntasks-per-node=2
#SBATCH --exclusive
#SBATCH -t HH:MM:SS

export nodecnt=$SLURM_JOB_NUM_NODES
export corecnt=`expr ${SLURM_CPUS_ON_NODE} \* ${nodecnt}`
export mpicnt=$SLURM_NTASKS
export threadspermpi=`expr ${SLURM_CPUS_ON_NODE} \/ ${SLURM_NTASKS_PER_NODE}`
export threadcnt=`expr ${mpicnt} \* ${threadspermpi}`
export OMP_NUM_THREADS=$threadspermpi
export OMP_PLACES=cores

if [ $threadcnt -ne $corecnt ]
then
  echo &quot;Error, mismatch between requested and available hardware!&quot;
  exit -1
fi

#Dial3
module purge
module load intel-parallel-studio/cluster.2019.5
module load arm/forge/21.0.2

#This will prevent Arm forge from closing if it cannot find license within a specified limit. 
export ALLINEA_NO_TIMEOUT=1

export EXE_DIR=Your_executable_directory_path

#The following command is responsible for generating your code profile.
map --profile  --processes=$SLURM_NTASKS --procs-per-node $SLURM_NTASKS_PER_NODE --mpi=intel-mpi $EXE_DIR/Your_executable
</code></pre>
<p><strong>3.</strong> Once your job ends, you will see a file with an extension <code>.map</code> which is your code profile. This file would be placed in the same directory from which the job was launched.</p>
<p><strong>4.</strong> Now connect the arm forge form your local system to the server and click on Arm map in the main GUI as shown in the image below.</p>
<p><img alt="" src="../../Images/Arm/arm_map.png" /></p>
<p><strong>5.</strong> Click the option <span style="color:green">'load the profile data from a previous runâ€™.</span> Browse to the location of file generated in <u><em>Step3</em></u>.</p>
<p><strong>6.</strong> This will now open the map profile and will give all necessary details about your code such as: OpenMp stacks, function times, MPI times, overhead etc. We can navigate through the source code also to see which function is taking more time. A typical code profile would like the image shown below.</p>
<p><img alt="" src="../../Images/Arm/profile.png" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Debug_code/" class="btn btn-neutral float-right" title="Debug your Code">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Perf_report/" class="btn btn-neutral" title="Performance Report"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../Perf_report/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Debug_code/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
